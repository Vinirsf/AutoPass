<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoPass</title>
  <link rel="manifest" href="manifest.json">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- AOS para animações -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <meta name="theme-color" content="#D0AF33">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg menu-principal sticky-top">
    <div class="container">
      <a href="#home" class="navbar-brand logo">
        <img src="images/android-launchericon-192-192.png" alt="AutoPass" class="logo-img">
        <span class="ms-2 fw-semibold brand-text">AutoPass</span>
      </a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a href="#home" class="nav-link menu-item active">Início</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link menu-item" onclick="escolherServico('Lavagem')">Lava-Rápidos</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link menu-item" onclick="escolherServico('Mecânica')">Mecânicas</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link menu-item" onclick="escolherServico('Estética')">Estéticas</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link menu-item" onclick="escolherServico('Borracharia')">Borracharias</a>
          </li>
        </ul>
        <div class="d-flex" id="auth-buttons">
          <button id="btn-login-topo" class="btn btn-primary">Entrar</button>
        </div>
      </div>
    </div>
  </nav>

  <main>
    <div id="home">
      <!-- Hero Section -->
      <section class="hero-section">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-lg-7 hero-text" data-aos="fade-right">
              <h1 class="display-4 fw-bold">Encontre os melhores serviços<br>automotivos perto de você</h1>
              <p class="hero-subtitle lead">Lava-rápidos, mecânicas, estéticas e borracharias em um só lugar!</p>
              
              <div class="search-container">
                <div class="input-group">
                  <input type="text" id="search-input" placeholder="Buscar serviços..." class="form-control border-0 shadow-none">
                  <button id="search-button" class="btn btn-primary">
                    <i class="bi bi-search me-2"></i>Buscar
                  </button>
                </div>
              </div>
            </div>
            <div class="col-lg-5 d-none d-lg-block" data-aos="fade-left">
              <img src="images/servicos.png" alt="Serviços Automotivos" class="img-fluid hero-image">
            </div>
          </div>
        </div>
      </section>

      <!-- Serviços em Destaque -->
      <section class="servicos-section">
        <div class="container">
          <h2 class="section-title" data-aos="fade-up">Serviços em Destaque</h2>
          
          <div class="servicos-grid" id="servicos-cards">
            <!-- Cards gerados via JavaScript -->
          </div>
        </div>
      </section>

      <!-- Métodos de Pagamento -->
      <section class="pagamento-section">
        <div class="container">
          <h2 class="section-title" data-aos="fade-up">Métodos de Pagamento</h2>
          
          <div class="pagamento-grid">
            <div class="pagamento-item" data-aos="zoom-in" data-aos-delay="100">
              <div class="pagamento-icon-container">
                <img src="images/credito-icon.png" alt="Crédito" class="pagamento-icon">
              </div>
              <p>Crédito</p>
            </div>
            <div class="pagamento-item" data-aos="zoom-in" data-aos-delay="200">
              <div class="pagamento-icon-container">
                <img src="images/debito-icon.png" alt="Débito" class="pagamento-icon">
              </div>
              <p>Débito</p>
            </div>
            <div class="pagamento-item" data-aos="zoom-in" data-aos-delay="300">
              <div class="pagamento-icon-container">
                <img src="images/pix-icon.png" alt="Pix" class="pagamento-icon">
              </div>
              <p>Pix</p>
            </div>
            <div class="pagamento-item" data-aos="zoom-in" data-aos-delay="400">
              <div class="pagamento-icon-container">
                <img src="images/local-icon.png" alt="No Local" class="pagamento-icon">
              </div>
              <p>No Local</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Download App -->
      <section class="download-section">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-lg-6 download-info" data-aos="fade-right">
              <h2 class="download-title">Baixe nosso aplicativo</h2>
              <p class="download-text">Acesse serviços automotivos de qualquer lugar e a qualquer momento</p>
              
              <div class="store-buttons">
                <a href="#" class="store-btn">
                  <i class="bi bi-google-play me-2"></i>
                  Google Play
                </a>
                <a href="#" class="store-btn">
                  <i class="bi bi-apple me-2"></i>
                  App Store
                </a>
              </div>
            </div>
            
            <div class="col-lg-6 app-preview" data-aos="fade-left">
              <div class="app-phone-container">
                <img src="images/android-launchericon-512-512.png" alt="App AutoPass" class="app-phone">
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div id="app" style="display:none;"></div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-logo">
          <img src="images/logo-autopass.png" alt="AutoPass" class="footer-logo-img">
          <p>Seu parceiro automotivo</p>
        </div>
        
        <div class="footer-links">
          <h3>Links Rápidos</h3>
          <ul>
            <li><a href="#sobre" onclick="navegarPagina('sobre')">Sobre Nós</a></li>
            <li><a href="#contato" onclick="navegarPagina('contato')">Contato</a></li>
            <li><a href="#termos" onclick="navegarPagina('termos')">Termos de Uso</a></li>
            <li><a href="#privacidade" onclick="navegarPagina('privacidade')">Política de Privacidade</a></li>
          </ul>
        </div>
        
        <div class="footer-contato">
          <h3>Contato</h3>
          <p><i class="bi bi-envelope-fill me-2"></i>contato@autopass.com</p>
          <p><i class="bi bi-telephone-fill me-2"></i>(11) 1234-5678</p>
          
          <div class="social-icons">
            <a href="#" class="social-icon"><i class="bi bi-facebook"></i></a>
            <a href="#" class="social-icon"><i class="bi bi-instagram"></i></a>
            <a href="#" class="social-icon"><i class="bi bi-twitter-x"></i></a>
          </div>
        </div>
      </div>
      
      <div class="footer-copyright">
        <p>&copy; 2024 AutoPass. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Modal de Login/Registro -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="loginModalLabel">Entrar no AutoPass</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs nav-fill mb-3" id="authTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-tab-pane" type="button" role="tab" aria-controls="login-tab-pane" aria-selected="true">Login</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="cadastro-tab" data-bs-toggle="tab" data-bs-target="#cadastro-tab-pane" type="button" role="tab" aria-controls="cadastro-tab-pane" aria-selected="false">Cadastro</button>
            </li>
          </ul>
          
          <!-- Tab panes -->
          <div class="tab-content" id="authTabContent">
            <!-- Login Tab -->
            <div class="tab-pane fade show active" id="login-tab-pane" role="tabpanel" aria-labelledby="login-tab" tabindex="0">
              <form id="login-form" class="mt-3">
                <div class="mb-3">
                  <label for="login-email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="login-email" required>
                </div>
                <div class="mb-3">
                  <label for="login-password" class="form-label">Senha</label>
                  <input type="password" class="form-control" id="login-password" required>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="remember-me">
                    <label class="form-check-label" for="remember-me">
                      Lembrar-me
                    </label>
                  </div>
                  <a href="#" class="text-decoration-none">Esqueceu a senha?</a>
                </div>
                <div id="login-error" class="alert alert-danger d-none"></div>
                <div class="d-grid gap-2">
                  <button type="submit" class="btn btn-primary">Entrar</button>
                </div>
              </form>
              
              <div class="separator my-4">
                <span>ou continue com</span>
              </div>
              
              <div class="d-grid gap-2">
                <button id="btn-google-login" class="btn btn-outline-dark">
                  <i class="bi bi-google me-2"></i>Google
                </button>
                <button id="btn-estabelecimento-login" class="btn btn-outline-primary">
                  <i class="bi bi-shop me-2"></i>Sou um estabelecimento
                </button>
                <a href="#cadastro-estabelecimento" class="btn btn-primary" onclick="document.getElementById('loginModal').classList.remove('show'); document.body.classList.remove('modal-open'); document.querySelector('.modal-backdrop').remove();">
                  <i class="bi bi-building-add me-2"></i>Cadastrar meu estabelecimento
                </a>
              </div>
            </div>
            
            <!-- Cadastro Tab -->
            <div class="tab-pane fade" id="cadastro-tab-pane" role="tabpanel" aria-labelledby="cadastro-tab" tabindex="0">
              <form id="register-form" class="mt-3">
                <div class="mb-3">
                  <label for="register-name" class="form-label">Nome completo</label>
                  <input type="text" class="form-control" id="register-name" required>
                </div>
                <div class="mb-3">
                  <label for="register-email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="register-email" required>
                </div>
                <div class="mb-3">
                  <label for="register-password" class="form-label">Senha</label>
                  <input type="password" class="form-control" id="register-password" required>
                  <div class="form-text">A senha deve ter pelo menos 6 caracteres</div>
                </div>
                <div class="mb-3">
                  <label for="register-password-confirm" class="form-label">Confirmar senha</label>
                  <input type="password" class="form-control" id="register-password-confirm" required>
                </div>
                <div class="mb-3 form-check">
                  <input type="checkbox" class="form-check-input" id="terms-agree" required>
                  <label class="form-check-label" for="terms-agree">
                    Concordo com os <a href="#termos" onclick="navegarPagina('termos')">Termos de Uso</a> e <a href="#privacidade" onclick="navegarPagina('privacidade')">Política de Privacidade</a>
                  </label>
                </div>
                <div id="register-error" class="alert alert-danger d-none"></div>
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary">Cadastrar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Login para Estabelecimentos -->
  <div class="modal fade" id="estabelecimentoModal" tabindex="-1" aria-labelledby="estabelecimentoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="estabelecimentoModalLabel">Login para Estabelecimentos</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="login-estabelecimento-form">
            <div class="mb-3">
              <label for="estab-login-email" class="form-label">Email do Estabelecimento</label>
              <input type="email" class="form-control" id="estab-login-email" required>
            </div>
            <div class="mb-3">
              <label for="estab-login-senha" class="form-label">Senha</label>
              <input type="password" class="form-control" id="estab-login-senha" required>
            </div>
            <div id="estab-login-error" class="alert alert-danger d-none"></div>
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">Entrar</button>
            </div>
          </form>
          
          <div class="separator my-4">
            <span>ou</span>
          </div>
          
          <div class="text-center">
            <p>Ainda não tem cadastro?</p>
            <a href="#cadastro-estabelecimento" class="btn btn-primary" onclick="document.getElementById('estabelecimentoModal').classList.remove('show'); document.body.classList.remove('modal-open'); document.querySelector('.modal-backdrop').remove();">
              Cadastrar novo estabelecimento
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast para notificações -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="autopassToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <img src="images/android-launchericon-192-192.png" class="rounded me-2" alt="AutoPass" width="20">
        <strong class="me-auto">AutoPass</strong>
        <small>Agora</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        <!-- Conteúdo dinâmico -->
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- AOS para animações -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="main.js"></script>

  <!-- Adicionar um script de inicialização no final da página -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Garantir que o botão de entrar funcione
      const btnEntrar = document.getElementById('btn-login-topo');
      if (btnEntrar) {
        btnEntrar.addEventListener('click', function() {
          // Verificar se o modal existe e está inicializado
          const loginModalElement = document.getElementById('loginModal');
          if (loginModalElement) {
            // Verificar se o Bootstrap está carregado
            if (window.bootstrap) {
              const modalInstance = new bootstrap.Modal(loginModalElement);
              modalInstance.show();
            } else {
              // Fallback caso o Bootstrap não esteja carregado
              alert('Sistema de login temporariamente indisponível. Tente novamente mais tarde.');
            }
          }
        });
      }

      // Configurar o botão "Sou um estabelecimento"
      const btnEstabelecimentoLogin = document.getElementById('btn-estabelecimento-login');
      if (btnEstabelecimentoLogin) {
        btnEstabelecimentoLogin.addEventListener('click', function() {
          // Fechar o modal de login
          const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
          if (loginModal) {
            loginModal.hide();
          }
          
          // Abrir o modal de estabelecimentos
          const estabelecimentoModalElement = document.getElementById('estabelecimentoModal');
          if (estabelecimentoModalElement) {
            const modalInstance = new bootstrap.Modal(estabelecimentoModalElement);
            modalInstance.show();
          }
        });
      }

      // Inicializar outros elementos do Bootstrap
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });

      // Assegurar que o modal de login esteja acessível globalmente
      window.showLogin = function() {
        const loginModalElement = document.getElementById('loginModal');
        if (loginModalElement) {
          const modalInstance = new bootstrap.Modal(loginModalElement);
          modalInstance.show();
        }
      };

      // Inicializar o Google Maps se estiver na página de mapa
      if (window.location.hash === '#mapa') {
        if (!window.google) {
          const script = document.createElement('script');
          script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyANeF6vSvBSzjbFJsJHDLEWa8IJvuRRD8E&callback=initMap&libraries=places`;
          script.async = true;
          document.head.appendChild(script);
        } else if (typeof initMap === 'function') {
          initMap();
        }
      }

      // Função para inicializar o mapa (será chamada pelo callback do script do Google Maps)
      window.initMap = function() {
        const mapElement = document.getElementById('map');
        if (mapElement) {
          const map = new google.maps.Map(mapElement, {
            center: { lat: -23.550520, lng: -46.633309 },
            zoom: 13
          });
          
          // Adicionar marcadores de exemplo (substituir com dados reais)
          const markers = [
            {
              position: { lat: -23.550520, lng: -46.633309 },
              title: "Oficina Brasil"
            },
            {
              position: { lat: -23.557890, lng: -46.640200 },
              title: "Auto Center Gold"
            }
          ];
          
          markers.forEach(markerInfo => {
            new google.maps.Marker({
              position: markerInfo.position,
              map: map,
              title: markerInfo.title
            });
          });
        }
      };

      // Adicionando função para login como estabelecimento no escopo global
      window.loginEstabelecimento = function(id) {
        // Fechar o modal de estabelecimentos
        const modalEstab = bootstrap.Modal.getInstance(document.getElementById('estabelecimentoModal'));
        if (modalEstab) {
          modalEstab.hide();
        }
        
        // Encontrar o estabelecimento correspondente
        const estabelecimento = window.dadosEstabelecimentos?.find(e => e.id === id);
        if (!estabelecimento) {
          alert('Estabelecimento não encontrado. Por favor, tente novamente.');
          return;
        }
        
        // Criar dados do usuário
        window.usuario = {
          id: 'user-estab-' + Date.now(),
          nome: estabelecimento.nome,
          email: estabelecimento.email || estabelecimento.nome.toLowerCase().replace(/\s+/g, '.') + '@exemplo.com',
          estabelecimentoId: estabelecimento.id,
          foto: estabelecimento.imagem || 'images/user-default.png'
        };
        
        window.tipoPainel = 'estabelecimento';
        
        // Atualizar interface e redirecionar
        atualizarInterfaceUsuario();
        exibirToast('Login como ' + estabelecimento.nome + ' realizado com sucesso!', 'success');
        navegar('#painel');
      };
      
      // Adicionar função auxiliar para exibir toast
      window.exibirToast = function(mensagem, tipo) {
        const toastElement = document.getElementById('autopassToast');
        if (!toastElement) return;
        
        const toastBody = toastElement.querySelector('.toast-body');
        if (toastBody) {
          toastBody.textContent = mensagem;
        }
        
        // Aplicar classe de acordo com o tipo
        const headerClass = tipo === 'success' ? 'bg-success text-white' : 
                          tipo === 'error' ? 'bg-danger text-white' : '';
        
        const toastHeader = toastElement.querySelector('.toast-header');
        if (toastHeader) {
          toastHeader.className = `toast-header ${headerClass}`;
        }
        
        const bsToast = new bootstrap.Toast(toastElement);
        bsToast.show();
      };
      
      // Função para atualizar interface após login
      window.atualizarInterfaceUsuario = function() {
        const btnLoginTopo = document.getElementById('btn-login-topo');
        if (window.usuario && btnLoginTopo) {
          btnLoginTopo.textContent = 'Meu Painel';
          btnLoginTopo.onclick = () => window.navegar('#painel');
        }
      };
      
      // Função de navegação para o escopo global
      window.navegar = function(rota) {
        window.location.hash = rota;
        
        // Se a rota for a de cadastro de estabelecimento, renderizar o formulário
        if (rota === '#cadastro-estabelecimento') {
          renderizarCadastroEstabelecimento();
        }
        
        // Se for a rota do painel e o usuário for um estabelecimento, renderizar o painel
        if (rota === '#painel' && window.tipoPainel === 'estabelecimento') {
          renderizarPainelEstabelecimento();
        }
      };
    });
  </script>

  <!-- Script para cadastro e paineis de estabelecimento -->
  <script>
    // Inicializar cliente Supabase
    const supabaseUrl = 'https://pgjcbjnlcmsjzabehthy.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnamNiam5sY21zanphYmVodGh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4Nzc4NjMsImV4cCI6MjA2MTQ1Mzg2M30.g8_Xm_r2dbUZlO4haMwDOgXO-e2JsVGncnWltP1diC4';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Função para renderizar cadastro de estabelecimento
    window.renderizarCadastroEstabelecimento = function() {
      const app = document.getElementById('app');
      document.getElementById('home').style.display = 'none';
      app.style.display = '';
      
      app.innerHTML = `
        <div class="container py-4">
          <h2 class="mb-4">Cadastro de Estabelecimento</h2>
          
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <form id="form-cadastro-estabelecimento">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <h4 class="h5 mb-3">Informações Básicas</h4>
                    
                    <div class="mb-3">
                      <label for="estab-nome" class="form-label">Nome do Estabelecimento *</label>
                      <input type="text" class="form-control" id="estab-nome" required>
                    </div>
                    
                    <div class="mb-3">
                      <label for="estab-responsavel" class="form-label">Nome do Responsável *</label>
                      <input type="text" class="form-control" id="estab-responsavel" required>
                    </div>
                    
                    <div class="mb-3">
                      <label for="estab-email" class="form-label">Email *</label>
                      <input type="email" class="form-control" id="estab-email" required>
                    </div>
                    
                    <div class="mb-3">
                      <label for="estab-senha" class="form-label">Senha *</label>
                      <input type="password" class="form-control" id="estab-senha" required minlength="6">
                      <div class="form-text">A senha deve ter pelo menos 6 caracteres</div>
                    </div>
                    
                    <div class="mb-3">
                      <label for="estab-confirmar-senha" class="form-label">Confirmar Senha *</label>
                      <input type="password" class="form-control" id="estab-confirmar-senha" required minlength="6">
                    </div>
                    
                    <div class="mb-3">
                      <label for="estab-telefone" class="form-label">Telefone *</label>
                      <input type="tel" class="form-control" id="estab-telefone" placeholder="(00) 00000-0000" required>
                    </div>
                  </div>
                  
                  <div class="col-md-6">
                    <h4 class="h5 mb-3">Endereço</h4>
                    
                    <div class="mb-3">
                      <label for="estab-endereco" class="form-label">Endereço *</label>
                      <input type="text" class="form-control" id="estab-endereco" required>
                    </div>
                    
                    <div class="mb-3">
                      <label for="estab-cidade" class="form-label">Cidade *</label>
                      <input type="text" class="form-control" id="estab-cidade" required>
                    </div>
                    
                    <div class="mb-3">
                      <label for="estab-estado" class="form-label">Estado *</label>
                      <select class="form-select" id="estab-estado" required>
                        <option value="">Selecione o estado</option>
                        <option value="SP">São Paulo</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PR">Paraná</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                <div class="row mb-4">
                  <div class="col-12">
                    <h4 class="h5 mb-3">Serviços Oferecidos</h4>
                    
                    <div class="mb-3">
                      <div class="row">
                        <div class="col-md-3">
                          <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="servico-mecanica" name="servicos" value="Mecânica">
                            <label class="form-check-label" for="servico-mecanica">Mecânica</label>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="servico-borracharia" name="servicos" value="Borracharia">
                            <label class="form-check-label" for="servico-borracharia">Borracharia</label>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="servico-lavagem" name="servicos" value="Lavagem">
                            <label class="form-check-label" for="servico-lavagem">Lavagem</label>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="servico-estetica" name="servicos" value="Estética">
                            <label class="form-check-label" for="servico-estetica">Estética</label>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <label for="estab-descricao" class="form-label">Descrição do estabelecimento *</label>
                      <textarea class="form-control" id="estab-descricao" rows="3" placeholder="Descreva seu estabelecimento, especialidades e diferenciais" required></textarea>
                    </div>
                  </div>
                </div>
                
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                  <button type="button" class="btn btn-outline-secondary" onclick="navegar('#home')">Cancelar</button>
                  <button type="submit" class="btn btn-primary">Cadastrar Estabelecimento</button>
                  <div id="cadastro-loading" class="spinner-border text-primary d-none" role="status">
                    <span class="visually-hidden">Carregando...</span>
                  </div>
                </div>
                <div id="cadastro-erro" class="alert alert-danger mt-3 d-none"></div>
              </form>
            </div>
          </div>
        </div>
      `;
      
      // Configurar o formulário
      const form = document.getElementById('form-cadastro-estabelecimento');
      const loadingSpinner = document.getElementById('cadastro-loading');
      const erroMsg = document.getElementById('cadastro-erro');
      
      if (form) {
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          // Exibir spinner e limpar erro
          loadingSpinner.classList.remove('d-none');
          erroMsg.classList.add('d-none');
          
          // Verificar senhas
          const senha = document.getElementById('estab-senha').value;
          const confirmarSenha = document.getElementById('estab-confirmar-senha').value;
          
          if (senha !== confirmarSenha) {
            erroMsg.textContent = 'As senhas não coincidem';
            erroMsg.classList.remove('d-none');
            loadingSpinner.classList.add('d-none');
            return;
          }
          
          // Capturar serviços selecionados
          const servicosSelecionados = [];
          document.querySelectorAll('input[name="servicos"]:checked').forEach(checkbox => {
            servicosSelecionados.push(checkbox.value);
          });
          
          if (servicosSelecionados.length === 0) {
            erroMsg.textContent = 'Selecione pelo menos um serviço oferecido';
            erroMsg.classList.remove('d-none');
            loadingSpinner.classList.add('d-none');
            return;
          }
          
          try {
            // 1. Criar o usuário com autenticação
            const email = document.getElementById('estab-email').value;
            
            const { data: authData, error: authError } = await supabase.auth.signUp({
              email: email,
              password: senha,
              options: {
                data: {
                  tipo: 'estabelecimento'
                }
              }
            });
            
            if (authError) throw authError;
            
            // 2. Criar o registro do estabelecimento
            const { data: estabData, error: estabError } = await supabase
              .from('estabelecimentos')
              .insert({
                id: authData.user.id,
                nome: document.getElementById('estab-nome').value,
                email: email,
                telefone: document.getElementById('estab-telefone').value,
                responsavel: document.getElementById('estab-responsavel').value,
                endereco: document.getElementById('estab-endereco').value,
                cidade: document.getElementById('estab-cidade').value,
                estado: document.getElementById('estab-estado').value,
                descricao: document.getElementById('estab-descricao').value,
                status: 'ativo',
                data_cadastro: new Date(),
                imagem: 'https://source.unsplash.com/random/300x200/?business'
              })
              .select();
            
            if (estabError) throw estabError;
            
            // 3. Inserir os serviços oferecidos
            for (const servico of servicosSelecionados) {
              const { error: servicoError } = await supabase
                .from('servicos_estabelecimento')
                .insert({
                  estabelecimento_id: authData.user.id,
                  tipo_servico: servico
                });
              
              if (servicoError) throw servicoError;
            }
            
            // 4. Fazer login com o novo usuário
            window.usuario = {
              id: authData.user.id,
              nome: document.getElementById('estab-nome').value,
              email: email,
              estabelecimentoId: authData.user.id,
              foto: 'https://source.unsplash.com/random/300x200/?business'
            };
            window.tipoPainel = 'estabelecimento';
            
            // Feedback e navegação
            window.exibirToast('Estabelecimento cadastrado com sucesso!', 'success');
            window.atualizarInterfaceUsuario();
            
            // Ir para o painel do estabelecimento
            setTimeout(() => window.navegar('#painel'), 1000);
            
          } catch (error) {
            console.error('Erro ao cadastrar:', error);
            erroMsg.textContent = error.message || 'Erro ao cadastrar estabelecimento. Tente novamente.';
            erroMsg.classList.remove('d-none');
          } finally {
            loadingSpinner.classList.add('d-none');
          }
        });
      }
    };

    // Função para renderizar painel do estabelecimento
    window.renderizarPainelEstabelecimento = async function() {
      const app = document.getElementById('app');
      document.getElementById('home').style.display = 'none';
      app.style.display = '';
      
      // Verificar autenticação
      const { data: session } = await supabase.auth.getSession();
      if (!session) {
        app.innerHTML = `
          <div class="container py-5 text-center">
            <div class="alert alert-warning">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              Você precisa fazer login como estabelecimento para acessar esta área.
            </div>
            <button class="btn btn-primary mt-3" onclick="showLogin()">Fazer login</button>
          </div>
        `;
        return;
      }
      
      app.innerHTML = `<div class="container py-4 text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Carregando...</span>
        </div>
        <p class="mt-2">Carregando informações...</p>
      </div>`;
      
      try {
        // Buscar dados do estabelecimento
        const { data: estabelecimento, error: estabError } = await supabase
          .from('estabelecimentos')
          .select('*')
          .eq('id', session.user.id)
          .single();
        
        if (estabError) throw estabError;
        
        // Buscar serviços oferecidos
        const { data: servicos, error: servicosError } = await supabase
          .from('servicos_estabelecimento')
          .select('tipo_servico')
          .eq('estabelecimento_id', session.user.id);
        
        if (servicosError) throw servicosError;
        
        // Buscar agendamentos
        const { data: agendamentos, error: agendasError } = await supabase
          .from('agendamentos')
          .select('*')
          .eq('estabelecimento_id', session.user.id)
          .order('data_agendamento', { ascending: true });
        
        if (agendasError) throw agendasError;
        
        // Buscar avaliações
        const { data: avaliacoes, error: avalError } = await supabase
          .from('avaliacoes')
          .select('*')
          .eq('estabelecimento_id', session.user.id)
          .order('data_avaliacao', { ascending: false });
        
        if (avalError) throw avalError;
        
        // Renderizar painel com os dados obtidos
        // (código omitido por brevidade - será similar ao que já está implementado,
        // mas usando os dados do banco em vez de dados simulados)
        
        // O restante do código para renderizar o painel continua similar...
        
      } catch (error) {
        console.error('Erro ao carregar dados:', error);
        app.innerHTML = `
          <div class="container py-5 text-center">
            <div class="alert alert-danger">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              Erro ao carregar dados: ${error.message || 'Falha na conexão'}
            </div>
            <button class="btn btn-primary mt-3" onclick="renderizarPainelEstabelecimento()">Tentar novamente</button>
          </div>
        `;
      }
    };

    // Função para login de estabelecimento
    window.loginEstabelecimento = async function(email, senha) {
      try {
        const { data, error } = await supabase.auth.signInWithPassword({
          email: email,
          password: senha
        });
        
        if (error) throw error;
        
        // Buscar dados do estabelecimento
        const { data: estabelecimento, error: estabError } = await supabase
          .from('estabelecimentos')
          .select('*')
          .eq('id', data.user.id)
          .single();
        
        if (estabError) throw estabError;
        
        // Criar dados do usuário
        window.usuario = {
          id: data.user.id,
          nome: estabelecimento.nome,
          email: estabelecimento.email,
          estabelecimentoId: estabelecimento.id,
          foto: estabelecimento.imagem || 'images/user-default.png'
        };
        
        window.tipoPainel = 'estabelecimento';
        
        // Atualizar interface e redirecionar
        atualizarInterfaceUsuario();
        exibirToast('Login como ' + estabelecimento.nome + ' realizado com sucesso!', 'success');
        navegar('#painel');
        
      } catch (error) {
        console.error('Erro no login:', error);
        exibirToast('Erro no login: ' + (error.message || 'Falha na autenticação'), 'error');
      }
    };

    // Função para logout
    window.fazerLogout = async function() {
      try {
        await supabase.auth.signOut();
        
        window.usuario = null;
        window.tipoPainel = null;
        
        // Atualizar botão de login
        const btnLoginTopo = document.getElementById('btn-login-topo');
        if (btnLoginTopo) {
          btnLoginTopo.textContent = 'Entrar';
          btnLoginTopo.onclick = () => {
            const loginModalElement = document.getElementById('loginModal');
            if (loginModalElement) {
              const modalInstance = new bootstrap.Modal(loginModalElement);
              modalInstance.show();
            }
          };
        }
        
        window.exibirToast('Logout realizado com sucesso!', 'info');
        window.navegar('#home');
        
      } catch (error) {
        console.error('Erro ao fazer logout:', error);
        window.exibirToast('Erro ao fazer logout: ' + (error.message || 'Falha na conexão'), 'error');
      }
    };

    // Verificar hash na inicialização para carregar a tela correta
    document.addEventListener('DOMContentLoaded', function() {
      if (window.location.hash === '#cadastro-estabelecimento') {
        window.renderizarCadastroEstabelecimento();
      }
    });
  </script>

  <!-- Adicionar script para gerenciar o login -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const loginForm = document.getElementById('login-form');
      const loginError = document.getElementById('login-error');
      
      if (loginForm) {
        loginForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const email = document.getElementById('login-email').value;
          const senha = document.getElementById('login-password').value;
          
          try {
            // Tentar login
            const { data, error } = await supabase.auth.signInWithPassword({
              email: email,
              password: senha
            });
            
            if (error) throw error;
            
            // Verificar se é um estabelecimento
            const { data: estabelecimento, error: estabError } = await supabase
              .from('estabelecimentos')
              .select('*')
              .eq('id', data.user.id)
              .single();
            
            if (estabError) {
              // Se não for estabelecimento, é um usuário comum
              window.usuario = {
                id: data.user.id,
                email: data.user.email,
                tipo: 'usuario'
              };
              window.tipoPainel = 'usuario';
            } else {
              // Se for estabelecimento
              window.usuario = {
                id: data.user.id,
                nome: estabelecimento.nome,
                email: estabelecimento.email,
                estabelecimentoId: estabelecimento.id,
                foto: estabelecimento.imagem || 'images/user-default.png',
                tipo: 'estabelecimento'
              };
              window.tipoPainel = 'estabelecimento';
            }
            
            // Fechar modal e atualizar interface
            const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
            if (loginModal) {
              loginModal.hide();
            }
            
            window.atualizarInterfaceUsuario();
            window.exibirToast('Login realizado com sucesso!', 'success');
            
            // Redirecionar para o painel apropriado
            if (window.tipoPainel === 'estabelecimento') {
              window.navegar('#painel');
            } else {
              window.navegar('#perfil');
            }
            
          } catch (error) {
            console.error('Erro no login:', error);
            loginError.textContent = error.message || 'Erro ao fazer login. Verifique suas credenciais.';
            loginError.classList.remove('d-none');
          }
        });
      }
      
      // Configurar botão de estabelecimento
      const btnEstabelecimento = document.getElementById('btn-estabelecimento-login');
      if (btnEstabelecimento) {
        btnEstabelecimento.addEventListener('click', function() {
          // Fechar modal de login
          const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
          if (loginModal) {
            loginModal.hide();
          }
          
          // Abrir modal de estabelecimento
          const estabelecimentoModal = new bootstrap.Modal(document.getElementById('estabelecimentoModal'));
          estabelecimentoModal.show();
        });
      }
    });
  </script>

  <!-- Adicionar handler para o formulário de login de estabelecimento -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const loginEstabelecimentoForm = document.getElementById('login-estabelecimento-form');
      const estabLoginError = document.getElementById('estab-login-error');
      
      if (loginEstabelecimentoForm) {
        loginEstabelecimentoForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const email = document.getElementById('estab-login-email').value;
          const senha = document.getElementById('estab-login-senha').value;
          
          try {
            // Tentar login
            const { data, error } = await supabase.auth.signInWithPassword({
              email: email,
              password: senha
            });
            
            if (error) throw error;
            
            // Verificar se é um estabelecimento
            const { data: estabelecimento, error: estabError } = await supabase
              .from('estabelecimentos')
              .select('*')
              .eq('id', data.user.id)
              .single();
            
            if (estabError) {
              throw new Error('Esta conta não é de um estabelecimento.');
            }
            
            // Configurar dados do estabelecimento
            window.usuario = {
              id: data.user.id,
              nome: estabelecimento.nome,
              email: estabelecimento.email,
              estabelecimentoId: estabelecimento.id,
              foto: estabelecimento.imagem || 'images/user-default.png',
              tipo: 'estabelecimento'
            };
            window.tipoPainel = 'estabelecimento';
            
            // Fechar modal e atualizar interface
            const estabelecimentoModal = bootstrap.Modal.getInstance(document.getElementById('estabelecimentoModal'));
            if (estabelecimentoModal) {
              estabelecimentoModal.hide();
            }
            
            window.atualizarInterfaceUsuario();
            window.exibirToast('Login como estabelecimento realizado com sucesso!', 'success');
            window.navegar('#painel');
            
          } catch (error) {
            console.error('Erro no login:', error);
            estabLoginError.textContent = error.message || 'Erro ao fazer login. Verifique suas credenciais.';
            estabLoginError.classList.remove('d-none');
          }
        });
      }
    });
  </script>
</body>
</html>